<!doctype html>
<html ng-app="project">

<head>
    <title>Мой Удобный Учет: Личный Кабинет</title>

    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/redmond/jquery-ui.css" />

    <!-- Bootstrap 2 -->
{#    <link href="/static/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">#}
{#    <script src="/static/libs/bootstrap/js/bootstrap.min.js"></script>#}

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <!-- Angular -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.min.js"></script>

    <link rel="stylesheet" href="/static/css/common.css" />

    <link rel="shortcut icon" type="image/png" href="/static/img/favicon.png"/>

    <script src="/static/js/improove_ctrl.js"></script>

    <!-- Настройка приложения Ангулар -->
    <script src="/static/js/angular_project.js"></script>

    <!-- Ангулар-директива клавиша ввод и Ins - используется на "Учет", "Счета", "Категории" -->
    <script src="/static/js/ang-keys.js"></script>

    <!-- Форматирование дат -->
    <script type="text/javascript" src="/static/libs/moment/moment.min.js"></script>

    <!-- Вспомогательные разные функции -->
    <script src="/static/js/uu_utils.js"></script>

    <style>
        {# Без этого стиля слишком высокие пункты главного меню на всех страницаз и узкие #}
        .nav>li>a {
            padding: 5px 12px;
            position: relative;
            top: 2px;
        }
    </style>


    <script>

        {# А это спец. тултипы на странице анализа #}
        function SiliTooltipCtrl2($scope, $element){
            // Всплывающая подсказка.
            $(function () {
                // Если текст корткий, то подсказка не нужна.
                var is_need = ($element[0].offsetWidth < $element[0].scrollWidth) || ($element.attr('title'))? true: false;
                var text = $element.attr('title') ? $element.attr('title') : $element.text();
                if (is_need){
                    // Внутренний текст одобавляем подчеркивание.
                    $element.find('span').attr('style', 'border-bottom: 1px dashed;');
                    $element.tooltip({ placement: "top", title: text, });
                }
            });
        }
    </script>

    {% block add_to_head %}

    {% endblock %}

</head>

<body id="myuu_reset_css">

    <div class="page_content_container" style="position: relative; padding-top: 113px;">

        <a class="logo__text" href="{% url 'my_uu.views.lk_uch' %} " style="position: fixed; top: 16px; margin-left: 50%; left: -430px; z-index: 101;">
            «Мой Удобный Учет»
        </a>

        <div class="logout">
            <span class="logout__email">{{ user.username }}</span>
            <a class="logout__link" href="/logout_user/">Выход</a>
        </div>

        <ul class="nav nav-pills" style="position: fixed; visibility: block; top: 73px; z-index: 101;">
            <li{% block beg_active %}{% endblock %}><a href="/lk/beg/">Начало</a></li>
            <li style="width: 2px; background-color: rgb(212, 224, 236);float: left; display: list-item; height: 16px; margin: 9px 3px; margin-left: 5px; margin-right: 1px;">&nbsp;</li>
            <li{% block acc_active %}{% endblock %}><a href="/lk/acc/">Счета</a></li>
            <li{% block cat_active %}{% endblock %}><a href="/lk/cat/">Категории</a></li>
            <li{% block uch_active %}{% endblock %}><a href="/lk/">Учет</a></li>
            <li{% block ana_active %}{% endblock %}><a href="/lk/ana/">Анализ</a></li>
            <li style="width: 2px; background-color: rgb(212, 224, 236);float: left; display: list-item; height: 16px; margin: 9px 3px; margin-left: 5px; margin-right: 1px;">&nbsp;</li>
            <li{% block imp_active %}{% endblock %}><a href="/lk/imp/">Импорт</a></li>
            <li{% block exp_active %}{% endblock %}><a href="/lk/exp/">Экспорт</a></li>

            {% if user.userprofile.is20DaysUser %}
                <li style="width: 2px; background-color: rgb(212, 224, 236);float: left; display: list-item; height: 16px; margin: 9px 3px">&nbsp;</li>
                <li{% block pay_active %}{% endblock %}><a href="/lk/pay/">Оплата</a></li>
            {% endif %}


        </ul>

        <div style="background-color: white; height: 112px; z-index: 100; position: fixed; width: 860px; top: 0px;"></div>

        {% block lk_content %}

        {% endblock %}

        <style>
            .improove__panel {
                position: fixed;
                right: 0;
                bottom: 50%;
                margin-bottom: -15px;
                width: 132px;
                height: 68px;
                padding: 5px;
                background-color: lavender;
                border: 1px solid lightblue;
                z-index: 95;
            }
            .improove__btn {
                color: rgb(39, 100, 133);
                font-weight: bold;
                width: 120px;
            }
            .improove-dlg {
                position: fixed;
                z-index: 110;
            }
        </style>
        <div class="improove__panel">
            <button class="btn improove__btn btn-default" id="improove">Вопрос или <br>предложение</button>
        </div>

        <div id="improove-dialog-modal" style="display: none; padding-top: 20px; padding-right: 30px; padding-left: 15px;" ng-controller="ImprooveCtrl">
            <ul>
                <li>Не получается сделать то, что хочется и нужна подсказка?</li>
                <li>Что-то не удобно, хочется сообщить об этом?</li>
                <li>Хочется, чтобы появилась нужная Вам функция?</li>
            </ul>
            <p>
                Напишите это в поле ниже и нажмите кнопку "Отправить".
            </p>
            <textarea rows="6" class="span7" ng-show="!isSendToServerNow && !isSendToServerSuccess && !isSendToServerError" style="resize: none; width: 100%;" ng-model="improoveText">
            </textarea>
            <div class="alert alert-info" ng-show="isSendToServerNow">
                Отправка на сервер, подождите...
            </div>
            <div class="alert alert-success" ng-show="isSendToServerSuccess">
                Ваше сообщение успешно отправлено!
            </div>
            <div class="alert alert-error" ng-show="isSendToServerError">
                <span ng:bind="errorText"></span>
            </div>
            <div style="position: absolute; bottom: 15px; right: 15px;">
                <button class="btn btn-success pull-right" ng-click="sendToServer()" ng-disabled="isSendToServerNow || isSendToServerSuccess">Отправить</button>
                <button class="btn pull-right" style="margin-right: 15px;" ng-click="clearStatus()" id="improoveDlgCloseBtn">Закрыть (Esc)</button>
            </div>
        </div>

        <script>
            $('#improove').click(function(){
                $( "#improove-dialog-modal" ).dialog({
                    modal: true,
                    dialogClass: "improove-dlg",
                    width: 600,
                    height: 360,
                    resizable: false,
                    title: 'Задать вопрос или сообщить предложение'
                });
                $( "#improove-dialog-modal").parent().find(".ui-dialog-titlebar-close").html("<span style='position: relative; top: -3px;'>&times;</span>");
            });
            $('#improoveDlgCloseBtn').click(function(){
                $( "#improove-dialog-modal" ).dialog('close');
            });
        </script>

    </div>

    <!-- Блок с ошибкой показывается если не удалось сохраниться на сервер 500 ошибка или нет связи -->
    <script>
        function ServerConectionErrorCtrl($scope){
            $scope.dialogVisible = false;
            $scope.messageType = null;
            $scope.jqReqFail = function(textCode, whatHappensMessage){

                // Нет связи с нетом
                if (textCode == ""){
                    $scope.$apply(function($scope){
                        $scope.whatHappensMessage = whatHappensMessage;
                        $scope.messageType = "CON";
                        $scope.dialogVisible = true;
                    });

                // Internal server error
                } else {
                    $scope.$apply(function($scope){
                        $scope.whatHappensMessage = whatHappensMessage;
                        $scope.messageType = "ERR";
                        $scope.dialogVisible = true;
                    });
                };

            };
            $scope.angReqFail = function(whatHappensMessage){

                // Нет связи с нетом или ошибка на сервере
                $scope.whatHappensMessage = whatHappensMessage;
                $scope.messageType = "ANG";
                $scope.dialogVisible = true;

            };
            $scope.hide = function(){
                $scope.dialogVisible = false;
            }
        };
    </script>
    <div id="serverConnectionError" class="alert alert-error" style="z-index: 2000; position: fixed; width: 400px; margin-left: 50%; top: 100px; left: -200px; border: 3px solid #b94a48;" ng-controller="ServerConectionErrorCtrl" ng-show="dialogVisible" ng-cloak>
        <div ng-if="messageType == 'ERR'">
            <p><strong>Ошибка на сервере. ((</strong></p>
            <p><strong>{$whatHappensMessage$}</strong></p>
            <p>Мы уведомлены и спешим починить.</p>
            <p>Сейчас Вы можете:</p>
            <ul>
                <li>Обновить страницу, иногда это срабатывает.</li>
                <li>Повторить попытку, тоже может сработать.</li>
                <li>Ждать починки: отложите работу на несколько часов.</li>
                <li>Уточнить решение в службе поддержки.</li>
            </ul>
        </div>
        <div ng-if="messageType == 'CON'">
            <p><strong>Нет связи с сервером. ((</strong></p>
            <p><strong>{$whatHappensMessage$}</strong></p>
            <p>Причины: либо соединение с интернетом, либо сервер.</p>
            <p>Сейчас Вы можете:</p>
            <ul>
                <li>Проверить свое соединение с интернетом.</li>
                <li>Обновить страницу и повторить попытку.</li>
                <li>Ждать починки: отложите работу на несколько часов.</li>
                <li>Уточнить решение в службе поддержки.</li>
            </ul>
        </div>
        <div ng-if="messageType == 'ANG'">
            <p><strong>Ошибка связи с сервером. ((</strong></p>
            <p><strong>{$whatHappensMessage$}</strong></p>
            <p>Причины: либо соединение с интернетом, либо сервер.</p>
            <p>Сейчас Вы можете:</p>
            <ul>
                <li>Проверить свое соединение с интернетом.</li>
                <li>Обновить страницу и повторить попытку.</li>
                <li>Ждать починки: отложите работу на несколько часов.</li>
                <li>Уточнить решение в службе поддержки.</li>
            </ul>
        </div>
        <button class="btn-default" ng-click="hide()">Закрыть</button>
    </div>
    <script>
        function uuJqReqFail(code, whatHappensMessage){
            $('#serverConnectionError').scope().jqReqFail(code, whatHappensMessage);
        };
        function uuAngReqFail(whatHappensMessage){
            $('#serverConnectionError').scope().angReqFail(whatHappensMessage);
        };
    </script>


    {% include 'include_yandex_metrika.html' %}
    {% include 'include_google_analytics.html' %}


</body>
</html>
